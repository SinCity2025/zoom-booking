{% extends 'base.html' %}
{% block content %}
<div class="row g-4">
  <div class="col-12">
    <div class="card shadow-sm">
      <div class="card-body">
        <!-- شريط أزرار علوي بنفس نمط admin.html -->
        <div class="d-flex flex-wrap gap-2 mb-3">
          <a href="{{ url_for('admin') }}" class="btn btn-outline-secondary btn-sm">الرجوع للحجوزات</a>
          <!-- لو عندك كلاس مخصص للأزرار الرئيسية استبدل btn-primary به -->
          <span class="badge bg-secondary align-self-center">إجمالي: {{ users|length }}</span>
        </div>

        <h5 class="mb-3">إدارة المستخدمين</h5>

        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for cat, msg in messages %}
              <div class="alert alert-{{cat}}">{{ msg }}</div>
            {% endfor %}
          {% endif %}
        {% endwith %}

        {% if users %}
          <div class="table-responsive">
            <table class="table align-middle">
              <thead>
                <tr>
                  <th>#</th>
                  <th>الاسم</th>
                  <th>البريد</th>
                  <th class="text-center">أدمن؟</th>
                  <th class="text-center" style="width:320px">إجراءات</th>
                </tr>
              </thead>
              <tbody>
                {% for u in users %}
                <tr>
                  <td>{{ u.id }}</td>
                  <td>{{ u.name }}</td>
                  <td>{{ u.email }}</td>
                  <td class="text-center">
                    {% if u.is_admin %}
                      <span class="badge bg-success">نعم</span>
                    {% else %}
                      <span class="badge bg-secondary">لا</span>
                    {% endif %}
                  </td>
                  <td class="text-center">
                    {% if not u.is_admin %}
                      <form class="d-inline" method="post" action="{{ url_for('admin_make_admin', uid=u.id) }}">
                        <button class="btn btn-sm btn-primary">ترقية لأدمن</button>
                      </form>
                    {% else %}
                      <form class="d-inline" method="post" action="{{ url_for('admin_remove_admin', uid=u.id) }}">
                        <button class="btn btn-sm btn-outline-warning">إلغاء أدمن</button>
                      </form>
                    {% endif %}

                    {% if user and user.id != u.id %}
                    <form class="d-inline" method="post"
                          action="{{ url_for('admin_delete_user', uid=u.id) }}"
                          onsubmit="return confirm('متأكد من حذف هذا المستخدم؟ سيُحذف معه سجل حجوزاته.');">
                      <button class="btn btn-sm btn-outline-danger">حذف</button>
                    </form>
                    {% endif %}
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <div class="text-muted">لا يوجد مستخدمون بعد.</div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}